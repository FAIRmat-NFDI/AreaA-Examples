# Part 2: NOMAD's Base Sections and Built-in Schemas for Electronic Lab Notebooks (ELNs)

### Summary 
In this part of the tutorial, we will learn:

* different levels of schemas in NOMAD, starting with base sections.

This will be followed by demo on:
* how to use "Build-in Schemas" which inherit the base sections. These are out-of-the-box
 solutions to structure your data in NOMAD.
* how to use "Custom YAML Schemas", which allows to extend the base sections by defining
additional quantities and sub-sections.
* how to use a pre-implemented plugin `nomad_measurements.xrd` to enjoy the automation
of parsing and populating schemas. 

### Prerequisites
We will work on the [NOMAD example oasis](https://nomad-lab.eu/prod/v1/oasis/gui/search/entries).
Make sure you have your NOMAD account ready to work on the example oasis.

## 2.1: Using Built-in ELN Schemas
In NOMAD, you can structure and save your experimental data using built-in schemas
prepared to have ready-to-use ELNs functionalities.

This tutorial guides you through some of these schemas using an example from sintering.
Sintering in materials science is the process of heating powdered materials to induce 
particle bonding and densification, enhancing mechanical properties without reaching melting point.

We will learn how to use NOMAD's ExperimentELN, SampleELN, ProcessELN, and
MeasurementELN schemas to digitize a fictional experimental workflow for sintering.

> [!WARNING]
> Since this is a fictional example, the data is not to be trusted.

### Create an Upload
The first step for uploading data to NOMAD is creating an "Upload", which will
contains your raw files along with the processed entries generated by NOMAD. Read more
about uploads in the official [NOMAD documentation](https://nomad-lab.eu/prod/v1/oasis/docs/reference/glossary.html#upload).

Follow these steps to create your upload.

<div align="center">
	<br>
	<a href="https://github.com/sindresorhus/css-in-readme-like-wat/blame/main/header.svg">
		<img src="image.svg" width="800" height="400" alt="Click to see the source">
	</a>
	<br>
</div>
<!-- <img src="image.svg" width='600'>
[](https://scribehow.com/embed/Create_new_Upload_on_NOMAD_Lab_Oasis_Platform__8n74Ia2KRS6813lZJ9hmtA){:target='_blank'} -->

<!-- 
<iframe src="https://scribehow.com/embed/Create_new_Upload_on_NOMAD_Lab_Oasis_Platform__8n74Ia2KRS6813lZJ9hmtA" width="80%" height="600" allowfullscreen frameborder="0"></iframe> -->

### Add the Experiment and steps involved
After creating an upload, we will create an entry using Experiment ELN. Within this
ELN entry, we will create steps: the sintering (Process) and XRD (Measurement). Each of the
step will be an individual entry in the upload folder, and will be connected to the 
Experiment ELN via [references](https://nomad-lab.eu/prod/v1/staging/docs/howto/customization/basics.html#references). 
References are crucial to record highly inter-linked data, 
allowing us to navigate in our data structure in a very agile fashion. 

A graphical summary of our experiment is available in the `Overview > Workflow` section, 
as shown in the last frame below.

<iframe src="https://scribehow.com/embed/Create_Experiment_ELN_for_Sintering_Process__dWi9ZL2RS9mKJ1XPsL32XQ" width="80%" height="600" allowfullscreen frameborder="0"></iframe>


### Add the Sample and populate the Process step

Process ELN entry can be found in the upload page. We will populate it with sintering
steps. But before we do that, we will create a Sample ELN from within the Process ELN.

After creating the sample and referencing it inside the Process ELN, we will populate
the Sample ELN. You can specify the elemental compositions and components of the sample.
If the component is a recognized pure substance, you can use `PureSubstanceComponent`
section to automatically access PubChem database and populate certain quantities in the
ELN.

Once the sample is populated, we will go back to the Process ELN and add two process
steps: heating and cooling. For each of the steps, we will add the temperature range
in the free text `comment` field. This kind of quantity is a `RichTextField` 
as shown in the [dedicated documentation](https://nomad-lab.eu/prod/v1/staging/gui/dev/editquantity#iss=https%3A%2F%2Fnomad-lab.eu%2Ffairdi%2Fkeycloak%2Fauth%2Frealms%2Ffairdi_nomad_prod).

<iframe src="https://scribehow.com/embed/Populate_Process_ELN_and_create_Sample_ELN__As9sadvhS4a979Cd7rOPyA" width="80%" height="600" allowfullscreen frameborder="0"></iframe>

### Populate the Measurement results
We will go into the Measurement ELN on the upload page and add XRD data. 
We will use the free text `comment` field available also here under `results` sub-section. 
In our example, this will be an image of the XRD pattern. 
`RichTextField` field do not offer structure data, but they allow for direct upload of images or pdf files.

Here, we will also reference the sample created in the previous exercise. This is an
example of using references to create connections between entries: sample is 
linked with both measurement and process. 

<iframe src="https://scribehow.com/embed/Populating_ELN_Measurement__P21WfffiSZaRVTYpcjaVXQ" width="80%" height="600" allowfullscreen frameborder="0"></iframe>

## 2.2: Customization of the ELNs
The built-in schemas are general base sections. They can be used for myriad types of processes
and measurements. Owing to their simplicity, however, they can be limiting in case of
specific schema requirements.

Luckily, NOMAD provides two ways of adding technique-specific behavior to the ELNs.

* YAML schemas - config file containing schemas added to the upload
* Plugins - Python package added as an extension to NOMAD

Using our sintering example, we will show how to specialize the Process ELN with a YAML
schema. We also show how to use a pre-implemented plugin to create an XRD specific 
Measurement ELN.

### YAML schema
We will use a custom YAML schema [available here](https://github.com/FAIRmat-NFDI/AreaA-Examples/blob/main/tutorial13/part2/files/custom_schema/sintering.archive.yaml) to define the following sections:
* `TemperatureRamp` which inherits
`ProcessStep` base section and adds two new quantities: `Initial Temperature` and 
`Final Temperature`
* `Sintering` section which inherits `Process` base section and uses `TemperatureRamp` 
to define its steps.

This leads to an improvement over the generic Process ELN we used in the previous
exercise, because now you can define the temperature range for heating and cooling steps
in a structured way, rather than putting this information as the `comment`.

You can learn how to create your own YAML schemas in our [previous tutorial](https://youtu.be/5VXGZNlz9rc?feature=shared).

You can navigate in this repo in the [Tutorial 8](https://github.com/FAIRmat-NFDI/AreaA-Examples/tree/main/tutorial8) folder 
to see some examples of YAML files that inherit and extend existing classes.

<iframe src="https://scribehow.com/embed/Create_Custom_Sintering_Process_Schema___uGkfGM-SziDbaiu9Ojpyg" width="80%" height="600" allowfullscreen frameborder="0"></iframe>

### XRD Plugin
Plugins provide high degree of control on the behavior of ELNs based on user-defined Python
code. We can use this feature to define the automation behind the ELNs. For example,
files dropped in the upload can be automatically parsed. Further, the parsed data and 
metadata can be used to populate the ELNs.

We will use one such plugin developed for XRD measurement: `nomad_measurement.xrd`. It allows to import the
measurement data directly from a measurement file (coming from the instrument) into an
ELN entry. Further, it automatically generates XRD pattern plots based on the data.

Our job is to extend the set of available plugin to cover more and more use cases common in the lab.
Please feel free to take a look at them and comment in the repo, open issues, or pull requests:
* [nomad-material-processing](https://github.com/FAIRmat-NFDI/nomad-material-processing) contains classes to describe synthesis processes.
* [nomad-measurements](https://github.com/FAIRmat-NFDI/nomad-measurements) contains classes to describe characterization of samples.
* [nomad-analysis](https://github.com/FAIRmat-NFDI/nomad-analysis) contains classes to describe post-processing or analysis routines.

<iframe src="https://scribehow.com/embed/Create_XRD_Measurement_ELN_entry_using_plugin__CaFgPhKwTju8hjrSop9Vrg" width="80%" height="600" allowfullscreen frameborder="0"></iframe>


## Example upload
After following the steps mentioned above, we end with an upload containing some 
raw files and processed entries. You can find a zip file [here](https://github.com/FAIRmat-NFDI/AreaA-Examples/blob/main/tutorial13/part2/files/example_upload/ptw1yj4WQsmFqZCYTEup6Q.zip)
of the upload we created during the demo. 

You can use it to create a copy of the upload in your NOMAD. Simply drop this 
zip filed in an empty upload. 

However, keep in mind that the references of a copied upload might not work, because the
references will point to `entry_id` of entries in NOMAD where the upload was created. 
Whereas, each entry in the new upload will be assigned a different `entry_id`. 
